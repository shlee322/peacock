{% raw %}
<script type="text/ng-template" id="entityModalContent.html">
    <div class="modal-header">
        <h3 class="modal-title">{{ entity_kind  }} - {{ entity_id }}</h3>
    </div>
    <div class="modal-body">
        <form class="form-inline" role="form">
            <div class="form-group">
                <input type="date" class="form-control" id="date" ng-model="formData.start_date" readonly>
            </div>
            <div class="form-group">
                <input type="time" class="form-control" id="time" ng-model="formData.start_time" readonly>
            </div>
            <div class="form-group">
                ~
            </div>
            <div class="form-group">
                <input type="date" class="form-control" id="date" ng-model="formData.end_date" readonly>
            </div>
            <div class="form-group">
                <input type="time" class="form-control" id="time" ng-model="formData.end_time" readonly>
            </div>
        </form>
        <table class="table table-condensed">
            <thead>
                <tr>
                    <th width="120px">Event</th>
                    <th width="*">Timeline</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>test.asdf</td>
                    <td>
                        <div class="progress">
                            <div class="progress-bar" style="margin-top: 35%; width: 35%">
                            </div>
                            <div class="progress-bar progress-bar-striped" style="width: 20%">
                                3ms
                            </div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>test.asdf</td>
                    <td>
                        <div class="progress">
                            <div class="progress-bar" style="margin-top: 50%; width: 50%">
                            </div>
                            <div class="progress-bar progress-bar-striped" style="width: 20%">
                                3ms
                            </div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>test.asdf</td>
                    <td>
                        <div class="progress">
                            <div class="progress-bar" style="margin-top: 70%; width: 70%">
                            </div>
                            <div class="progress-bar progress-bar-striped" style="width: 30%">
                                3ms
                            </div>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</script>

<script type="application/javascript">
    peacock.config(function(WebSocketProvider){
        WebSocketProvider
          .prefix('')
          .uri("ws://localhost:7000/" + service_id);
    });

    peacock.controller('entityModalController', function ($scope, $modalInstance, $filter, WebSocket, kind, id, timestamp) {
        $scope.entity_kind = kind;
        $scope.entity_id = id;

        $scope.formData = {};
        $scope.formData.start_date = $filter('date')(timestamp - 10000, 'yyyy-MM-dd');
        $scope.formData.start_time = $filter('date')(timestamp - 10000, 'HH:mm:ss');
        $scope.formData.end_date = $filter('date')(timestamp, 'yyyy-MM-dd');
        $scope.formData.end_time = $filter('date')(timestamp, 'HH:mm:ss');

        WebSocket.send(JSON.stringify({
            'method': 'get_entity_timeline',
            'entity': {
                'kind': kind,
                'id': id
            },
            'timestamp': timestamp,
            'timestamp_length': timestamp - 10000
        }));
    });

    function openEntityModal($modal, kind, id, timestamp) {
        var modalInstance = $modal.open({
            templateUrl: 'entityModalContent.html',
            controller: 'entityModalController',
            size:'lg',
            resolve: {
                kind:function() { return kind; },
                id:function() { return id; },
                timestamp:function() { return timestamp; }
            }
        });
    }
</script>
{% endraw %}
